default_platform(:ios)

before_all do
  ENV["FASTLANE_BUNDLE_ID"] = ENV["FASTLANE_BUNDLE_ID"] || "de.marcelkraus.speedometer"
  ENV["FASTLANE_APPLE_ID"] = ENV["FASTLANE_APPLE_ID"] || "marcel@marcelkraus.de"
end

lane :test do
  run_tests(scheme: "Speedometer")
end

lane :beta do
  test

  increment_build_number(build_number: latest_testflight_build_number(version: get_version_number, initial_build_number: 0) + 1)

  build_app(workspace: "Speedometer.xcworkspace", scheme: "Speedometer")

  upload_to_testflight(skip_waiting_for_build_processing: true)

  clean_build_artifacts
end
